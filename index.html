<!DOCTYPE html>
<html lang="en">
<head>
<style type="text/css" media="screen">
    html {
		margin: 0;
		padding: 0;
		background-color: #000;
	}
    body {
		margin: 0;
		padding: 0;
	}
	#editor { 
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
</style>
</head>
<body>

<div id="editor"></div>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ace.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-elastic_tabstops_lite.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-emmet.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-keybinding_menu.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-modelist.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-options.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-searchbox.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-settings_menu.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-spellcheck.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-static_highlight.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-statusbar.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-textarea.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-themelist.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ext-whitespace.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/keybinding-emacs.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/keybinding-vim.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-coffee.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-css.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-javascript.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-json.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-lua.js"></script> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-php.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/worker-xquery.js"></script>
<script src="ace/mode-lua.js"></script>
<script src="ace/snippets/lua.js"></script>
<script>
    var editor = ace.edit("editor"); 
	ace.require("ace/ext/language_tools");
	ace.require('ace/ext/settings_menu').init(editor);
	ace.require('ace/ext/keybinding_menu').init(editor);

	editor.setOptions({
        "enableBasicAutocompletion": true,
        "enableSnippets": true,
		//"enableEmmet": true,
		"scrollPastEnd": true,
		"setHighlightActiveLine": true,
		"setShowPrintMargin": true
    });
	
	editor.getSession().setUseSoftTabs(false);
	editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/lua");
	editor.focus();

	// callbacks

	// lua->js
	function SetTheme(themename) {
		//OnLog("SetTheme "+themename);
		editor.setTheme("ace/theme/"+themename);
	}
	function SetMode(editormode) {
		//OnLog("SetMode "+editormode);
		editor.getSession().setMode("ace/mode/"+editormode);
	}
	function GotoLine(linenum) {
		//OnLog("GotoLine "+linenum);
		editor.gotoLine(linenum);
	}
	function SetContent(code) {
		//OnLog("SetContent "+code);
		editor.getSession().getDocument().setValue(code);
	}
	function SetErr(errline,errstr) {
		//OnLog("SetErr "+errstr);
		editor.getSession().setAnnotations([{row: errline - 1, text: errstr, type: "error"}]);
	}
	function ClearErr() {
		//OnLog("ClearErr");
		editor.getSession().clearAnnotations();
	}
	function ShowMenu() {
		//OnLog("ShowMenu");
		editor.showSettingsMenu();
	}
	function ShowBinds() {
		//OnLog("ShowBinds");
		editor.showKeyboardShortcuts();
	}

	// js->lua
	function OnReady() {
		try {
			gmodinterface.OnReady();
			editor.focus();
		} catch (err) {
			console.log("ERR OnReady: "+err);
		}
	}
	function OnCode(code) {
		try {
			gmodinterface.OnCode(code);
		} catch (err) {
			console.log("ERR OnCode: "+err);
		}
	}
	function OnLog(logstr) {
		try {
			gmodinterface.OnLog(logstr);
		} catch (err) {
			console.log("ERR OnLog: "+err);
		}
	}

	editor.getSession().on('change', function(){
	   
		var text = editor.getSession().getValue();
		OnCode(text);
		
	});
	
	document.addEventListener('DOMContentLoaded',OnReady);
	
</script>

</body>
</html>